/*
 * bootstrap-tagsinput v0.4.2 by Tim Schlechter
 *
 */

!function(a){"use strict";function c(b,c){this.itemsArray=[],this.$element=a(b),this.$element.hide(),this.isSelect="SELECT"===b.tagName,this.multiple=this.isSelect&&b.hasAttribute("multiple"),this.objectItems=c&&c.itemValue,this.placeholderText=b.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=a('<div class="bootstrap-tagsinput"></div>'),this.$input=a('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container);var d=(this.inputSize<3?3:this.inputSize)+"em";this.$input.get(0).style.cssText="width: "+d+" !important;",this.build(c)}function d(a,b){if("function"!=typeof a[b]){var c=a[b];a[b]=function(a){return a[c]}}}function e(a,b){if("function"!=typeof a[b]){var c=a[b];a[b]=function(){return c}}}function g(a){return a?f.text(a).html():""}function h(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart);return b}function i(b,c){var d=!1;return a.each(c,function(a,c){if("number"==typeof c&&b.which===c)return d=!0,!1;if(b.which===c.which){var e=!c.hasOwnProperty("altKey")||b.altKey===c.altKey,f=!c.hasOwnProperty("shiftKey")||b.shiftKey===c.shiftKey,g=!c.hasOwnProperty("ctrlKey")||b.ctrlKey===c.ctrlKey;if(e&&f&&g)return d=!0,!1}}),d}var b={tagClass:function(a){return"badge badge-info"},itemValue:function(a){return a?a.toString():a},itemText:function(a){return this.itemValue(a)},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],onTagExists:function(a,b){b.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};c.prototype={constructor:c,add:function(b,c){var d=this;if(!(d.options.maxTags&&d.itemsArray.length>=d.options.maxTags)&&(b===!1||b)){if("string"==typeof b&&d.options.trimValue&&(b=a.trim(b)),"object"==typeof b&&!d.objectItems)throw"Can't add objects when itemValue option is not set";if(!b.toString().match(/^\s*$/)){if(d.isSelect&&!d.multiple&&d.itemsArray.length>0&&d.remove(d.itemsArray[0]),"string"==typeof b&&"INPUT"===this.$element[0].tagName){var e=b.split(",");if(e.length>1){for(var f=0;f<e.length;f++)this.add(e[f],!0);return void(c||d.pushVal())}}var h=d.options.itemValue(b),i=d.options.itemText(b),j=d.options.tagClass(b),k=a.grep(d.itemsArray,function(a){return d.options.itemValue(a)===h})[0];if(!k||d.options.allowDuplicates){if(!(d.items().toString().length+b.length+1>d.options.maxInputLength)){var m=a.Event("beforeItemAdd",{item:b,cancel:!1});if(d.$element.trigger(m),!m.cancel){d.itemsArray.push(b);var n=a('<span class="tag '+g(j)+'">'+g(i)+'<span data-role="remove"></span></span>');if(n.data("item",b),d.findInputWrapper().before(n),n.after(" "),d.isSelect&&!a('option[value="'+encodeURIComponent(h)+'"]',d.$element)[0]){var o=a("<option selected>"+g(i)+"</option>");o.data("item",b),o.attr("value",h),d.$element.append(o)}c||d.pushVal(),d.options.maxTags!==d.itemsArray.length&&d.items().toString().length!==d.options.maxInputLength||d.$container.addClass("bootstrap-tagsinput-max"),d.$element.trigger(a.Event("itemAdded",{item:b}))}}}else if(d.options.onTagExists){var l=a(".tag",d.$container).filter(function(){return a(this).data("item")===k});d.options.onTagExists(b,l)}}}},remove:function(b,c){var d=this;if(d.objectItems&&(b="object"==typeof b?a.grep(d.itemsArray,function(a){return d.options.itemValue(a)==d.options.itemValue(b)}):a.grep(d.itemsArray,function(a){return d.options.itemValue(a)==b}),b=b[b.length-1]),b){var e=a.Event("beforeItemRemove",{item:b,cancel:!1});if(d.$element.trigger(e),e.cancel)return;a(".tag",d.$container).filter(function(){return a(this).data("item")===b}).remove(),a("option",d.$element).filter(function(){return a(this).data("item")===b}).remove(),a.inArray(b,d.itemsArray)!==-1&&d.itemsArray.splice(a.inArray(b,d.itemsArray),1)}c||d.pushVal(),d.options.maxTags>d.itemsArray.length&&d.$container.removeClass("bootstrap-tagsinput-max"),d.$element.trigger(a.Event("itemRemoved",{item:b}))},removeAll:function(){var b=this;for(a(".tag",b.$container).remove(),a("option",b.$element).remove();b.itemsArray.length>0;)b.itemsArray.pop();b.pushVal()},refresh:function(){var b=this;a(".tag",b.$container).each(function(){var c=a(this),d=c.data("item"),e=b.options.itemValue(d),f=b.options.itemText(d),h=b.options.tagClass(d);if(c.attr("class",null),c.addClass("tag "+g(h)),c.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=g(f),b.isSelect){var i=a("option",b.$element).filter(function(){return a(this).data("item")===d});i.attr("value",e)}})},items:function(){return this.itemsArray},pushVal:function(){var b=this,c=a.map(b.items(),function(a){return b.options.itemValue(a).toString()});b.$element.val(c,!0).trigger("change")},build:function(c){var f=this;if(f.options=a.extend({},b,c),f.objectItems&&(f.options.freeInput=!1),d(f.options,"itemValue"),d(f.options,"itemText"),e(f.options,"tagClass"),f.options.typeahead){var g=f.options.typeahead||{};e(g,"source"),f.$input.typeahead(a.extend({},g,{source:function(b,c){function d(a){for(var b=[],d=0;d<a.length;d++){var g=f.options.itemText(a[d]);e[g]=a[d],b.push(g)}c(b)}this.map={};var e=this.map,h=g.source(b);a.isFunction(h.success)?h.success(d):a.isFunction(h.then)?h.then(d):a.when(h).then(d)},updater:function(a){f.add(this.map[a])},matcher:function(a){return a.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1},sorter:function(a){return a.sort()},highlighter:function(a){var b=new RegExp("("+this.query+")","gi");return a.replace(b,"<strong>$1</strong>")}}))}if(f.options.typeaheadjs){var j=f.options.typeaheadjs||{};f.$input.typeahead(null,j).on("typeahead:selected",a.proxy(function(a,b){j.valueKey?f.add(b[j.valueKey]):f.add(b),f.$input.typeahead("val","")},f))}f.$container.on("click",a.proxy(function(a){f.$element.attr("disabled")||f.$input.removeAttr("disabled"),f.$input.focus()},f)),f.options.addOnBlur&&f.options.freeInput&&f.$input.on("focusout",a.proxy(function(b){0===a(".typeahead, .twitter-typeahead",f.$container).length&&(f.add(f.$input.val()),f.$input.val(""))},f)),f.$container.on("keydown","input",a.proxy(function(b){var c=a(b.target),d=f.findInputWrapper();if(f.$element.attr("disabled"))return void f.$input.attr("disabled","disabled");switch(b.which){case 8:if(0===h(c[0])){var e=d.prev();e&&f.remove(e.data("item"))}break;case 46:if(0===h(c[0])){var g=d.next();g&&f.remove(g.data("item"))}break;case 37:var i=d.prev();0===c.val().length&&i[0]&&(i.before(d),c.focus());break;case 39:var j=d.next();0===c.val().length&&j[0]&&(j.after(d),c.focus())}var k=c.val().length;Math.ceil(k/5);c.attr("size",Math.max(this.inputSize,c.val().length))},f)),f.$container.on("keypress","input",a.proxy(function(b){var c=a(b.target);if(f.$element.attr("disabled"))return void f.$input.attr("disabled","disabled");var d=c.val(),e=f.options.maxChars&&d.length>=f.options.maxChars;f.options.freeInput&&(i(b,f.options.confirmKeys)||e)&&(f.add(e?d.substr(0,f.options.maxChars):d),c.val(""),b.preventDefault());var g=c.val().length;Math.ceil(g/5);c.attr("size",Math.max(this.inputSize,c.val().length))},f)),f.$container.on("click","[data-role=remove]",a.proxy(function(b){f.$element.attr("disabled")||f.remove(a(b.target).closest(".tag").data("item"))},f)),f.options.itemValue===b.itemValue&&("INPUT"===f.$element[0].tagName?f.add(f.$element.val()):a("option",f.$element).each(function(){f.add(a(this).attr("value"),!0)}))},destroy:function(){var a=this;a.$container.off("keypress","input"),a.$container.off("click","[role=remove]"),a.$container.remove(),a.$element.removeData("tagsinput"),a.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var b=this.$input[0],c=this.$container[0];b&&b.parentNode!==c;)b=b.parentNode;return a(b)}},a.fn.tagsinput=function(b,d){var e=[];return this.each(function(){var f=a(this).data("tagsinput");if(f)if(b||d){if(void 0!==f[b]){var g=f[b](d);void 0!==g&&e.push(g)}}else e.push(f);else f=new c(this,b),a(this).data("tagsinput",f),e.push(f),"SELECT"===this.tagName&&a("option",a(this)).attr("selected","selected"),a(this).val(a(this).val())}),"string"==typeof b?e.length>1?e:e[0]:e},a.fn.tagsinput.Constructor=c;var f=a("<div />");a(document).on("turbolinks:load",function(){a("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);
